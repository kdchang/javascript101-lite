<!DOCTYPE html>
<html>
  <head>
    <title>Wifi 熱點</title>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script type="text/javascript">
      function initMap() {
        var map;

        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 23.363882, lng: 121.044922},
          zoom: 11
        });

        var xhr = new XMLHttpRequest();
        xhr.open('GET', './itw_tw.json');
        xhr.onreadystatechange = function() {
          if(xhr.readyState === 4) {
            console.log(JSON.parse(xhr.responseText))
            var data = JSON.parse(xhr.responseText);
            data.forEach(function(value, index) {
              var contentString = '<div>' + value.NAME + '</div><div>' + value.ADDR + '</div>';
              var infowindow = new google.maps.InfoWindow({
                content: contentString
              });
              var lat = value.LATITUDE;
              var lng = value.LONGITUDE;
              var latLng = new google.maps.LatLng(lat, lng);
              var marker = new google.maps.Marker({
                position: latLng,
                map: map
              });            
              marker.addListener('click', function() {
                infowindow.open(map, marker);
              });
            });
          }
        };
        xhr.send();
      }
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDC53o1ZhyiloHN7wlr2fC_qrL9ij7ZcjE&callback=initMap&callback=initMap">
    </script>
  </body>
</html>